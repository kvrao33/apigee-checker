<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ProxyEndpoint name="default">
  <PreFlow name="PreFlow">
    <Request>
      <Step>
        <Name>FC-verifyjwt</Name>
      </Step>
      <Step>
        <Name>AM-removeHeader</Name>
      </Step>
      <Step>
        <Name>KVM-Customer-Fetch</Name>
      </Step>
      <Step>
        <Name>BA-AccessToken</Name>
      </Step>
      <Step>
        <Name>SC-accessToken</Name>
      </Step>
      <Step>
        <Name>JS-extractToken</Name>
      </Step>
      <Step>
        <Name>JS-SetHashInput</Name>
      </Step>
    </Request>
    <Response/>
  </PreFlow>
  <Flows>
    <Flow name="FetchCustomerInformation">
      <Description/>
      <Request>
        <Step>
          <Name>JS-FetchCustomerRequestValidation</Name>
        </Step>
        <Step>
          <Name>RF-BadRequest</Name>
          <Condition>isError=true</Condition>
        </Step>
      </Request>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/API/Fetch_CustomerInformation_v2") and (request.verb = "POST")</Condition>
    </Flow>
    <Flow name="generateOTP">
      <Description/>
      <Request/>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/api/v4/otp-gen") and (request.verb = "POST")</Condition>
    </Flow>
    <Flow name="validateOTP">
      <Description/>
      <Request/>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/api/v4/otp-val") and (request.verb = "POST")</Condition>
    </Flow>
    <Flow name="generateOTPV2">
      <Description/>
      <Request>
        <Step>
          <Name>Java-MessageHash</Name>
        </Step>
        <Step>
          <Name>JS-SetGenOtpRequest</Name>
        </Step>
      </Request>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/genOtp") and (request.verb = "POST")</Condition>
    </Flow>
    <Flow name="validateOTPV2">
      <Description/>
      <Request>
        <Step>
          <Name>Java-MessageHash</Name>
        </Step>
        <Step>
          <Name>JS-setValidateOtpRequest</Name>
        </Step>
      </Request>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/validateOtp") and (request.verb = "POST")</Condition>
    </Flow>
    <Flow name="fetchCustomerComposite">
      <Description/>
      <Request>
        <Step>
          <Name>EV-getPhoneNo</Name>
        </Step>
        <Step>
          <Name>SC-GenerateOTP</Name>
        </Step>
        <Step>
          <Name>Extract-Variables-1</Name>
        </Step>
        <Step>
          <Name>SC-VerifyOTP</Name>
        </Step>
        <Step>
          <Name>Extract-Variables-2</Name>
        </Step>
        <Step>
          <Name>SC-Fetch_CustomerInformation</Name>
        </Step>
        <Step>
          <Name>RF-sendResponse</Name>
        </Step>
      </Request>
      <Response/>
      <Condition>(proxy.pathsuffix MatchesPath "/fetchCustomerComposite") and (request.verb = "POST")</Condition>
    </Flow>
  </Flows>
  <PostFlow name="PostFlow">
    <Request>
      <Step>
        <Condition> proxy.pathsuffix != "/fetchCustomerComposite"</Condition>
        <Name>Java-HDFC-Bank-Encryption</Name>
      </Step>
    </Request>
    <Response>
      <Step>
        <Condition>response.status.code==200 and proxy.pathsuffix != "/fetchCustomerComposite"</Condition>
        <Name>Java-HDFC-Bank-Decypt</Name>
      </Step>
    </Response>
  </PostFlow>
  <PostClientFlow>
    <Response>
      <Step>
        <Name>FC-messagelogging</Name>
      </Step>
    </Response>
  </PostClientFlow>
  <HTTPProxyConnection>
    <BasePath>/customerInformation</BasePath>
  </HTTPProxyConnection>
  <RouteRule name="default">
    <TargetEndpoint>default</TargetEndpoint>
  </RouteRule>
</ProxyEndpoint>
